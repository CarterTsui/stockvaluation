<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Valuation - DCF Calculator</title>
    <script>
        async function fetchStockData() {
            let stockSymbol = document.getElementById('stockSymbol').value.toUpperCase();
            if (!stockSymbol) {
                alert("Please enter a stock symbol.");
                return;
            }

            // Update WSJ Link
            document.getElementById('wsjLink').href = `https://www.wsj.com/market-data/quotes/${stockSymbol}/financials/annual/cash-flow`;
            document.getElementById('wsjLink').style.display = "block";

            const apiKey = "YDB5A7GD2PIHTE0J"; // Ensure this is a valid API key
            const stockUrl = `https://www.alphavantage.co/query?function=OVERVIEW&symbol=${stockSymbol}&apikey=${apiKey}`;

            try {
                let stockResponse = await fetch(stockUrl);
                let stockData = await stockResponse.json();
                console.log("Stock Data:", stockData);

                if (stockData && stockData.Beta) {
                    document.getElementById('beta').value = parseFloat(stockData.Beta) || "";
                } else {
                    alert("Stock data not available. Check API key or try another stock symbol.");
                    return;
                }
            } catch (error) {
                console.error("Error fetching stock data:", error);
                alert("Error fetching stock data. Please check the console for details.");
            }
        }

        function calculateFCFPerShare() {
            let freeCashFlow = parseFloat(document.getElementById('freeCashFlow').value);
            let outstandingShares = parseFloat(document.getElementById('outstandingShares').value);

            if (isNaN(freeCashFlow) || isNaN(outstandingShares) || outstandingShares <= 0) {
                alert("Please enter valid numbers for Free Cash Flow and Outstanding Shares.");
                return;
            }

            let fcfPerShare = freeCashFlow / outstandingShares;
            document.getElementById('freeCashFlowPerShare').value = fcfPerShare.toFixed(2);
        }

        function calculateWACC() {
            let beta = parseFloat(document.getElementById('beta').value);
            let riskFreeRate = parseFloat(document.getElementById('riskFreeRate').value) / 100;
            let marketPremium = parseFloat(document.getElementById('marketPremium').value) / 100;
            let costDebt = parseFloat(document.getElementById('costDebt').value) / 100;
            let totalDebt = parseFloat(document.getElementById('totalDebt').value);
            let totalEquity = parseFloat(document.getElementById('totalEquity').value);
            let taxRate = 0.21; // Default tax rate

            if (isNaN(beta) || isNaN(riskFreeRate) || isNaN(marketPremium) || isNaN(costDebt) || isNaN(totalDebt) || isNaN(totalEquity)) {
                alert("Please enter valid values for WACC calculation.");
                return;
            }

            // Calculate Cost of Equity using CAPM Model
            let costEquity = riskFreeRate + beta * marketPremium;
            document.getElementById('costEquity').value = (costEquity * 100).toFixed(2); // Display in %

            // Calculate weight ratios
            let totalCapital = totalDebt + totalEquity;
            let equityRatio = totalEquity / totalCapital;
            let debtRatio = totalDebt / totalCapital;

            // Calculate WACC
            let wacc = (equityRatio * costEquity) + (debtRatio * costDebt * (1 - taxRate));
            document.getElementById('wacc').value = (wacc * 100).toFixed(2);
        }

        function calculateDCF() {
            let freeCashFlowPerShare = parseFloat(document.getElementById('freeCashFlowPerShare').value);
            let discountRate = parseFloat(document.getElementById('wacc').value) / 100;
            let growthRate = parseFloat(document.getElementById('growthRate').value) / 100;
            let years = parseInt(document.getElementById('years').value);
            let terminalGrowth = parseFloat(document.getElementById('terminalGrowth').value) / 100;

            if (isNaN(freeCashFlowPerShare) || isNaN(discountRate) || isNaN(growthRate) || isNaN(years) || isNaN(terminalGrowth)) {
                alert("Please enter valid values for DCF calculation.");
                return;
            }

            let projectedCashFlows = [];
            let totalDCF = 0;

            for (let i = 1; i <= years; i++) {
                freeCashFlowPerShare *= (1 + growthRate);
                let discountedValue = freeCashFlowPerShare / Math.pow((1 + discountRate), i);
                projectedCashFlows.push(discountedValue);
                totalDCF += discountedValue;
            }

            let terminalValue = (freeCashFlowPerShare * (1 + terminalGrowth)) / (discountRate - terminalGrowth);
            let discountedTerminalValue = terminalValue / Math.pow((1 + discountRate), years);

            let intrinsicValue = totalDCF + discountedTerminalValue;

            document.getElementById('result').innerText = intrinsicValue.toFixed(2);
            console.log("Intrinsic Value Calculated:", intrinsicValue);
        }
    </script>
</head>
<body>
    <div class="container">
        <h2>Discounted Cash Flow (DCF) Stock Valuation</h2>
        <label>Stock Symbol:</label>
        <input type="text" id="stockSymbol" placeholder="Enter Stock Symbol">
        <button onclick="fetchStockData()">Fetch Data</button>
        
        <p><a id="wsjLink" href="#" target="_blank" style="display: none;">View Stock Financials on WSJ</a></p>

        <label>Free Cash Flow:</label>
        <input type="number" id="freeCashFlow" placeholder="Enter Free Cash Flow">
        
        <label>Outstanding Shares:</label>
        <input type="number" id="outstandingShares" placeholder="Enter Outstanding Shares">
        
        <button onclick="calculateFCFPerShare()">Calculate FCF per Share</button>

        <label>Free Cash Flow per Share:</label>
        <input type="number" id="freeCashFlowPerShare" placeholder="Calculated FCF per Share" readonly>

        <label>EBIT Growth Rate (%):</label>
        <input type="number" id="growthRate" placeholder="Enter Growth Rate">
        
        <label>Number of Years for Projection:</label>
        <input type="number" id="years" placeholder="Enter Projection Years">

        <label>Terminal Growth Rate (%):</label>
        <input type="number" id="terminalGrowth" placeholder="Enter Terminal Growth Rate">

        <label>Stock Beta:</label>
        <input type="number" id="beta" placeholder="Enter Beta">
        
        <label>Risk-Free Rate (%):</label>
        <input type="number" id="riskFreeRate" placeholder="Enter Risk-Free Rate">
        
        <label>Market Risk Premium (%):</label>
        <input type="number" id="marketPremium" placeholder="Enter Market Risk Premium">

        <label>Cost of Equity (%):</label>
        <input type="number" id="costEquity" placeholder="Calculated Cost of Equity" readonly>

        <label>Cost of Debt (%):</label>
        <input type="number" id="costDebt" placeholder="Enter Cost of Debt">

        <label>Total Equity:</label>
        <input type="number" id="totalEquity" placeholder="Enter Total Equity">

        <label>Total Debt:</label>
        <input type="number" id="totalDebt" placeholder="Enter Total Debt">

        <label>WACC (%):</label>
        <input type="number" id="wacc" placeholder="Calculated WACC" readonly>

        <button onclick="calculateWACC()">Calculate WACC</button>
        <button onclick="calculateDCF()">Calculate DCF</button>

        <h3>Intrinsic Stock Value: <span id="result">N/A</span></h3>

<div class="container" style="margin-top: 30px; text-align: left;">
    <h3>ğŸ“Œ Instruction Guide (ä½¿ç”¨æŒ‡å—)</h3>
    <p><strong>1)</strong> Input your stock code.</p>
    <p><strong>2)</strong> Hit the "Fetch Data" button.</p>
    <p><strong>3)</strong> Click on the WSJ link to find the required financial data.</p>
    <p><strong>4)</strong> Find and input the following values from the WSJ webpage:</p>
    <ul>
        <li>Free Cash Flow</li>
        <li>Outstanding Shares</li>
    </ul>
    <p><strong>5)</strong> Click "Calculate FCF per Share" to compute the value.</p>
    <p><strong>6)</strong> Input your estimated growth rate (%). This is your prediction of how fast the company will grow.</p>
    <p><strong>7)</strong> Input the number of years for the projected growth rate.</p>
    <p><strong>8)</strong> Provide a terminal growth rate (usually suggested: <strong>2.5%</strong>).</p>
    <p><strong>9)</strong> Input the risk-free rate, market risk premium (usually <strong>5.5%</strong>), and cost of debt.  
       **(Cost of Debt represents the interest rate the company pays for its debt.)**</p>
    <p><strong>10)</strong> Find and input the following values from the WSJ webpage:</p>
    <ul>
        <li>Total Equity</li>
        <li>Total Debt</li>
    </ul>
    <p><strong>11)</strong> Click "Calculate WACC" to determine the discount rate.</p>
    <p><strong>12)</strong> Click "Calculate DCF" to compute the intrinsic stock value.</p>

    <h3>ğŸ“Œ ä½¿ç”¨æŒ‡å— (Traditional Chinese ç¹é«”ä¸­æ–‡)</h3>
    <p><strong>1)</strong> è¼¸å…¥æ‚¨çš„è‚¡ç¥¨ä»£ç¢¼ã€‚</p>
    <p><strong>2)</strong> é»æ“Š "Fetch Data" æŒ‰éˆ•ç²å–æ•¸æ“šã€‚</p>
    <p><strong>3)</strong> é»æ“Š WSJ ç¶²ç«™éˆæ¥ï¼Œåœ¨ç¶²é ä¸ŠæŸ¥æ‰¾æ‰€éœ€çš„è²¡å‹™æ•¸æ“šã€‚</p>
    <p><strong>4)</strong> å¾ WSJ é é¢æ‰¾åˆ°ä¸¦è¼¸å…¥ä»¥ä¸‹æ•¸æ“šï¼š</p>
    <ul>
        <li>è‡ªç”±ç¾é‡‘æµ (Free Cash Flow)</li>
        <li>æµé€šè‚¡æ•¸ (Outstanding Shares)</li>
    </ul>
    <p><strong>5)</strong> é»æ“Š "Calculate FCF per Share" ä¾†è¨ˆç®—æ¯è‚¡è‡ªç”±ç¾é‡‘æµã€‚</p>
    <p><strong>6)</strong> è¼¸å…¥æ‚¨çš„é æ¸¬å¢é•·ç‡ (%)ï¼Œé€™æ˜¯æ‚¨å°å…¬å¸æ¥­å‹™å¢é•·é€Ÿåº¦çš„ä¼°è¨ˆã€‚</p>
    <p><strong>7)</strong> è¼¸å…¥è©²å¢é•·ç‡æŒçºŒçš„å¹´æ•¸ã€‚</p>
    <p><strong>8)</strong> æä¾›çµ‚ç«¯å¢é•·ç‡ (é€šå¸¸å»ºè­° <strong>2.5%</strong>)ã€‚</p>
    <p><strong>9)</strong> è¼¸å…¥**ç„¡é¢¨éšªåˆ©ç‡ (Risk-Free Rate)**ï¼Œ**å¸‚å ´é¢¨éšªæº¢åƒ¹ (Market Risk Premiumï¼Œé€šå¸¸ <strong>5.5%</strong>)**ï¼Œä»¥åŠ**è² å‚µæˆæœ¬ (Cost of Debt)**ã€‚  
       **(è² å‚µæˆæœ¬è¡¨ç¤ºå…¬å¸ç‚ºå…¶å‚µå‹™æ”¯ä»˜çš„åˆ©ç‡ã€‚)**</p>
    <p><strong>10)</strong> å¾ WSJ é é¢æ‰¾åˆ°ä¸¦è¼¸å…¥ä»¥ä¸‹æ•¸æ“šï¼š</p>
    <ul>
        <li>ç¸½è‚¡æœ¬ (Total Equity)</li>
        <li>ç¸½è² å‚µ (Total Debt)</li>
    </ul>
    <p><strong>11)</strong> é»æ“Š "Calculate WACC" ä¾†è¨ˆç®—åŠ æ¬Šå¹³å‡è³‡æœ¬æˆæœ¬ (WACC)ã€‚</p>
    <p><strong>12)</strong> é»æ“Š "Calculate DCF" ä¾†è¨ˆç®—è‚¡ç¥¨çš„å…§åœ¨åƒ¹å€¼ (Intrinsic Stock Value)ã€‚</p>
</div>   
 </div>
</body>
</html>
